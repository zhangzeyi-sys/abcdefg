<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ç”µå½±è¯„ä»·ç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®ä¸åŸºç¡€è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }
        /* å¯¼èˆªæ æ ·å¼ */
        .nav {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-logo {
            font-size: 24px;
            font-weight: bold;
        }
        .nav-menu {
            display: flex;
            gap: 30px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 16px;
        }
        .nav-menu a:hover {
            color: #3498db;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        /* æ¨¡å—é€šç”¨æ ·å¼ */
        .module {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        .module-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
            padding-left: 10px;
        }
        /* ç”µå½±åˆ—è¡¨æ ·å¼ */
        .movie-list {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
        }
        .movie-card {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .movie-card:hover {
            transform: translateY(-5px);
        }
        .movie-poster {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }
        .movie-info {
            padding: 15px;
        }
        .movie-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .movie-score {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .movie-tag {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .movie-btn {
            width: 100%;
            padding: 8px 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .movie-btn:hover {
            background-color: #2980b9;
        }
        /* ç­›é€‰ä¸æœç´¢æ ·å¼ */
        .filter-search {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: center;
        }
        .filter-group {
            display: flex;
            gap: 15px;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-box {
            display: flex;
            margin-left: auto;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 280px;
            font-size: 14px;
        }
        .search-btn {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        /* å½±è¯„äº’åŠ¨æ ·å¼ */
        .review-section {
            margin-top: 30px;
        }
        .review-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }
        .score-input {
            margin-bottom: 15px;
            font-size: 14px;
        }
        .score-star {
            color: #ddd;
            font-size: 20px;
            cursor: pointer;
        }
        .score-star.active {
            color: #f39c12;
        }
        .submit-review {
            padding: 10px 20px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .review-list {
            margin-top: 30px;
        }
        .review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .review-user {
            font-weight: bold;
        }
        .review-score {
            color: #e74c3c;
        }
        .review-actions {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #7f8c8d;
        }
        .review-action {
            cursor: pointer;
        }
        .review-action:hover {
            color: #3498db;
        }
        /* ç”¨æˆ·ä¸­å¿ƒæ ·å¼ */
        .user-center {
            display: flex;
            gap: 30px;
        }
        .user-sidebar {
            width: 220px;
        }
        .sidebar-item {
            padding: 12px 15px;
            background-color: #f5f5f5;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .sidebar-item.active {
            background-color: #3498db;
            color: white;
        }
        .sidebar-item:hover:not(.active) {
            background-color: #eee;
        }
        .user-content {
            flex: 1;
        }
        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-label {
            font-size: 14px;
            font-weight: bold;
        }
        .form-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .save-profile {
            width: 120px;
            padding: 10px 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        /* ç®¡ç†å‘˜æ¨¡å—æ ·å¼ */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
        }
        .admin-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        .admin-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin-right: 8px;
        }
        .edit-btn {
            background-color: #f39c12;
            color: white;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        .approve-btn {
            background-color: #2ecc71;
            color: white;
        }
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }
        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        /* éšè—æ¨¡å—æ ·å¼ */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <div class="nav">
        <div class="container nav-content">
            <div class="nav-logo">åœ¨çº¿ç”µå½±è¯„ä»·ç³»ç»Ÿ</div>
            <div class="nav-menu">
                <a href="#" id="nav-movie">ç”µå½±æµè§ˆ</a>
                <a href="#" id="nav-review" class="hidden">è¯„ä»·äº’åŠ¨</a>
                <a href="#" id="nav-user" class="hidden">ç”¨æˆ·ä¸­å¿ƒ</a>
                <a href="#" id="nav-admin" class="hidden">ç®¡ç†å‘˜åå°</a>
            </div>
            <div class="user-info">
                <span id="login-text">æœªç™»å½•</span>
                <button id="login-btn" onclick="showLoginModal()">ç™»å½•/æ³¨å†Œ</button>
                <div class="user-avatar hidden" id="user-avatar" onclick="showUserMenu()">
                    <span id="avatar-initial">U</span>
                </div>
                <button id="logout-btn" class="hidden" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
        <!-- 1. ç”µå½±æµè§ˆæ¨¡å— -->
        <div class="module" id="movie-module">
            <div class="module-title">ç”µå½±æµè§ˆ</div>
            <!-- ç­›é€‰ä¸æœç´¢ -->
            <div class="filter-search">
                <div class="filter-group">
                    <select class="filter-select" id="category-filter">
                        <option value="all">å…¨éƒ¨ç±»åˆ«</option>
                        <option value="åŠ¨ä½œ">åŠ¨ä½œ</option>
                        <option value="å–œå‰§">å–œå‰§</option>
                        <option value="ç§‘å¹»">ç§‘å¹»</option>
                        <option value="çˆ±æƒ…">çˆ±æƒ…</option>
                        <option value="æ‚¬ç–‘">æ‚¬ç–‘</option>
                    </select>
                    <select class="filter-select" id="region-filter">
                        <option value="all">å…¨éƒ¨åœ°åŒº</option>
                        <option value="ä¸­å›½">ä¸­å›½</option>
                        <option value="ç¾å›½">ç¾å›½</option>
                        <option value="æ—¥æœ¬">æ—¥æœ¬</option>
                        <option value="éŸ©å›½">éŸ©å›½</option>
                    </select>
                    <select class="filter-select" id="year-filter">
                        <option value="all">å…¨éƒ¨å¹´ä»£</option>
                        <option value="20ä¸–çºª90å¹´ä»£">20ä¸–çºª90å¹´ä»£</option>
                        <option value="21ä¸–çºª10å¹´ä»£">21ä¸–çºª10å¹´ä»£</option>
                        <option value="21ä¸–çºª20å¹´ä»£">21ä¸–çºª20å¹´ä»£</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" placeholder="æœç´¢ç”µå½±åç§°/æ¼”å‘˜/å¯¼æ¼”...">
                    <button class="search-btn" onclick="searchMovie()">æœç´¢</button>
                </div>
            </div>
            <!-- ç”µå½±åˆ—è¡¨ -->
            <div class="movie-list" id="movie-list">
                <!-- ç”µå½±å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- 2. è¯„ä»·äº’åŠ¨æ¨¡å—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="module hidden" id="review-module">
            <div class="module-title">è¯„ä»·äº’åŠ¨</div>
            <div id="movie-detail">
                <!-- ç”µå½±è¯¦æƒ…å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <!-- å½±è¯„å‘å¸ƒåŒº -->
            <div class="review-section">
                <h3>å‘è¡¨ä½ çš„è¯„ä»·</h3>
                <div class="score-input">
                    <span>è¯„åˆ†ï¼š</span>
                    <span class="score-star" onclick="setScore(1)">â˜…</span>
                    <span class="score-star" onclick="setScore(2)">â˜…</span>
                    <span class="score-star" onclick="setScore(3)">â˜…</span>
                    <span class="score-star" onclick="setScore(4)">â˜…</span>
                    <span class="score-star" onclick="setScore(5)">â˜…</span>
                    <input type="hidden" id="selected-score" value="0">
                </div>
                <textarea class="review-input" id="review-content" placeholder="åˆ†äº«ä½ å¯¹è¿™éƒ¨ç”µå½±çš„çœ‹æ³•..."></textarea>
                <button class="submit-review" onclick="submitReview()">æäº¤è¯„ä»·</button>
            </div>
            <!-- å½±è¯„åˆ—è¡¨ -->
            <div class="review-list" id="review-list">
                <!-- å½±è¯„å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- 3. ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="module hidden" id="user-module">
            <div class="module-title">ç”¨æˆ·ä¸­å¿ƒ</div>
            <div class="user-center">
                <div class="user-sidebar">
                    <div class="sidebar-item active" onclick="showUserTab('profile')">ä¸ªäººèµ„æ–™</div>
                    <div class="sidebar-item" onclick="showUserTab('my-reviews')">æˆ‘çš„å½±è¯„</div>
                    <div class="sidebar-item" onclick="showUserTab('collected')">æˆ‘çš„æ”¶è—</div>
                    <div class="sidebar-item" onclick="showUserTab('watch-list')">è§‚å½±æ¸…å•</div>
                </div>
                <div class="user-content">
                    <!-- ä¸ªäººèµ„æ–™ -->
                    <div class="user-tab active" id="profile-tab">
                        <form class="profile-form">
                            <div class="form-group">
                                <label class="form-label">ç”¨æˆ·å</label>
                                <input type="text" class="form-input" id="username" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ä¸ªäººç®€ä»‹</label>
                                <textarea class="form-input" id="user-intro" rows="3" placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">å¤´åƒï¼ˆæ¨¡æ‹Ÿï¼‰</label>
                                <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;">
                                    <span id="profile-initial">U</span>
                                </div>
                            </div>
                            <button type="button" class="save-profile" onclick="saveProfile()">ä¿å­˜èµ„æ–™</button>
                        </form>
                    </div>
                    <!-- æˆ‘çš„å½±è¯„ -->
                    <div class="user-tab hidden" id="my-reviews-tab">
                        <div id="my-reviews-list">
                            <!-- æˆ‘çš„å½±è¯„å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <!-- æˆ‘çš„æ”¶è— -->
                    <div class="user-tab hidden" id="collected-tab">
                        <div class="movie-list" id="collected-list">
                            <!-- æ”¶è—ç”µå½±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <!-- è§‚å½±æ¸…å• -->
                    <div class="user-tab hidden" id="watch-list-tab">
                        <div class="movie-list" id="watched-list">
                            <!-- å·²çœ‹ç”µå½±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <div class="module-title" style="margin-top: 30px;">å¾…çœ‹ç”µå½±</div>
                        <div class="movie-list" id="to-watch-list">
                            <!-- å¾…çœ‹ç”µå½±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. ç®¡ç†å‘˜æ¨¡å—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="module hidden" id="admin-module">
            <div class="module-title">ç®¡ç†å‘˜åå°</div>
            <!-- ç”µå½±ä¿¡æ¯ç®¡ç† -->
            <div class="admin-section">
                <h3>ç”µå½±ä¿¡æ¯ç®¡ç†</h3>
                <button class="admin-btn edit-btn" onclick="showAddMovieModal()">æ·»åŠ ç”µå½±</button>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ç”µå½±ID</th>
                            <th>æ ‡é¢˜</th>
                            <th>ç±»åˆ«</th>
                            <th>åœ°åŒº</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="admin-movie-table">
                        <!-- ç”µå½±æ•°æ®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            <!-- å½±è¯„å®¡æ ¸ -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3>å½±è¯„å®¡æ ¸</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>å½±è¯„ID</th>
                            <th>ç”¨æˆ·</th>
                            <th>ç”µå½±</th>
                            <th>å†…å®¹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="admin-review-table">
                        <!-- å½±è¯„æ•°æ®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            <!-- ç”¨æˆ·è´¦å·ç®¡ç† -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3>ç”¨æˆ·è´¦å·ç®¡ç†</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="admin-user-table">
                        <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">ç”¨æˆ·ç™»å½•</div>
                <span class="close-modal" onclick="closeModal()">Ã—</span>
            </div>
            <div class="modal-body">
                <form id="auth-form">
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·å</label>
                        <input type="text" class="form-input" id="auth-username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¯†ç </label>
                        <input type="password" class="form-input" id="auth-password" required>
                    </div>
                    <button type="button" class="submit-review" onclick="submitAuth()">ç™»å½•</button>
                    <p style="margin-top: 15px; text-align: center; cursor: pointer;" onclick="toggleAuthMode()">
                        è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ç”µå½±æ¨¡æ€æ¡† -->
    <div class="modal" id="add-movie-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ·»åŠ æ–°ç”µå½±</div>
                <span class="close-modal" onclick="closeModal()">Ã—</span>
            </div>
            <div class="modal-body">
                <form id="add-movie-form">
                    <div class="form-group">
                        <label class="form-label">ç”µå½±æ ‡é¢˜</label>
                        <input type="text" class="form-input" id="movie-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç±»åˆ«</label>
                        <input type="text" class="form-input" id="movie-category" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åœ°åŒº</label>
                        <input type="text" class="form-input" id="movie-region" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¹´ä»£</label>
                        <input type="text" class="form-input" id="movie-year" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¯¼æ¼”</label>
                        <input type="text" class="form-input" id="movie-director" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¼”å‘˜</label>
                        <input type="text" class="form-input" id="movie-actors" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸Šæ˜ æ—¶é—´</label>
                        <input type="text" class="form-input" id="movie-release" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç‰‡é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                        <input type="number" class="form-input" id="movie-duration" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç”µå½±ç®€ä»‹</label>
                        <textarea class="form-input" id="movie-intro" rows="3" required></textarea>
                    </div>
                    <button type="button" class="submit-review" onclick="addMovie()">æ·»åŠ ç”µå½±</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€æ•°æ®ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼Œä½¿ç”¨localStorageæŒä¹…åŒ–ï¼‰
        let appData = {
            movies: [
                {
                    id: "movie001",
                    title: "æµæµªåœ°çƒ2",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2966788698.jpg",
                    avgScore: 8.3,
                    scoreCount: 123456,
                    category: "ç§‘å¹»/ç¾éš¾",
                    region: "ä¸­å›½",
                    year: "21ä¸–çºª20å¹´ä»£",
                    director: "éƒ­å¸†",
                    actors: "å´äº¬,åˆ˜å¾·å,æé›ªå¥",
                    releaseDate: "2023-01-22",
                    duration: 173,
                    intro: "å¤ªé˜³å³å°†æ¯ç­ï¼Œäººç±»åœ¨åœ°çƒè¡¨é¢å»ºé€ å‡ºå·¨å¤§çš„æ¨è¿›å™¨ï¼Œå¯»æ‰¾æ–°çš„å®¶å›­ã€‚ç„¶è€Œå®‡å®™ä¹‹è·¯å±æœºå››ä¼ï¼Œä¸ºäº†æ‹¯æ•‘åœ°çƒï¼Œæµæµªåœ°çƒæ—¶ä»£çš„å¹´è½»äººå†æ¬¡æŒºèº«è€Œå‡ºï¼Œå±•å¼€äº‰åˆ†å¤ºç§’çš„ç”Ÿæ­»ä¹‹æˆ˜ã€‚"
                },
                {
                    id: "movie002",
                    title: "èœ˜è››ä¾ ï¼šå¹³è¡Œå®‡å®™2",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2972463076.jpg",
                    avgScore: 8.7,
                    scoreCount: 98765,
                    category: "åŠ¨ç”»/åŠ¨ä½œ/ç§‘å¹»",
                    region: "ç¾å›½",
                    year: "21ä¸–çºª20å¹´ä»£",
                    director: "ä¹”ä¼Šå§†Â·å¤šæ–¯Â·æ¡‘æ‰˜æ–¯,å‡¯æ™®Â·é²å°”æ–¯,è´¾æ–¯æ±€Â·æ±¤æ™®æ£®",
                    actors: "æ²™æ¢…å…‹Â·æ‘©å°”,æµ·è‰Â·æ–¯å¦è²å°”å¾·,å¥¥æ–¯å¡Â·ä¼Šè¨å…‹",
                    releaseDate: "2023-06-02",
                    duration: 140,
                    intro: "å½±ç‰‡è®²è¿°äº†â€œå°é»‘è››â€è¿ˆå°”æ–¯Â·è«æ‹‰è±æ–¯ï¼Œèª“è¨€æ‰“ç ´ä¸‰ä»£èœ˜è››ä¾ éƒ½æ›¾ç»å†çš„â€œæ•‘ä¸€ä¸ªäººè¿˜æ˜¯æ•‘å…¨ä¸–ç•Œâ€çš„å‘½è¿é­”å’’ï¼Œç©¿è¶Šå¤šå…ƒå®‡å®™ä¸å¥³èœ˜è››ä¾ æ ¼æ¸©æºæ‰‹å¯»æ‰¾èœ˜è››ä¾ è”ç›Ÿï¼Œé˜»æ­¢åæ´¾â€œæ–‘ç‚¹â€æ‘§æ¯å¤šå…ƒå®‡å®™çš„æ•…äº‹ã€‚"
                },
                {
                    id: "movie003",
                    title: "åƒä¸åƒå¯»",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg",
                    avgScore: 9.4,
                    scoreCount: 234567,
                    category: "åŠ¨ç”»/å¥‡å¹»",
                    region: "æ—¥æœ¬",
                    year: "21ä¸–çºª00å¹´ä»£",
                    director: "å®«å´éª",
                    actors: "æŸŠç‘ ç¾,å…¥é‡è‡ªç”±,å¤æœ¨çœŸç†",
                    releaseDate: "2001-07-20",
                    duration: 125,
                    intro: "10å²çš„å°‘å¥³åƒå¯»ä¸çˆ¶æ¯ä¸€èµ·ä»éƒ½å¸‚æ¬å®¶åˆ°äº†ä¹¡ä¸‹ã€‚æ²¡æƒ³åˆ°åœ¨æ¬å®¶çš„é€”ä¸­ï¼Œä»–ä»¬è¿›å…¥äº†ä¸€ä¸ªç¥ç§˜çš„éš§é“ï¼Œæ¥åˆ°äº†ä¸€ä¸ªç”±ç¥çµã€å¦–æ€ªå’Œé­”æ³•æ„æˆçš„å¼‚ä¸–ç•Œã€‚çˆ¶æ¯å› ä¸ºè´ªåƒå˜æˆäº†çŒªï¼Œåƒå¯»å¿…é¡»åœ¨è¿™ä¸ªé™Œç”Ÿçš„ä¸–ç•Œä¸­ç”Ÿå­˜ä¸‹å»ï¼Œæ‹¯æ•‘çˆ¶æ¯å¹¶æ‰¾åˆ°å›å®¶çš„è·¯ã€‚"
                },
                {
                    id: "movie004",
                    title: "è‚–ç”³å…‹çš„æ•‘èµ",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p480980688.jpg",
                    avgScore: 9.7,
                    scoreCount: 345678,
                    category: "å‰§æƒ…/çŠ¯ç½ª",
                    region: "ç¾å›½",
                    year: "20ä¸–çºª90å¹´ä»£",
                    director: "å¼—å…°å…‹Â·å¾·æ‹‰é‚¦ç‰¹",
                    actors: "è’‚å§†Â·ç½—å®¾æ–¯,æ‘©æ ¹Â·å¼—é‡Œæ›¼,é²å‹ƒÂ·å†ˆé¡¿",
                    releaseDate: "1994-09-10",
                    duration: 142,
                    intro: "é“¶è¡Œå®¶å®‰è¿ªå› è¢«è¯¬å‘Šè°‹æ€å¦»å­åŠå…¶æƒ…äººè€Œè¢«åˆ¤æ— æœŸå¾’åˆ‘ï¼Œè¿›å…¥äº†è‚–ç”³å…‹ç›‘ç‹±ã€‚åœ¨ç‹±ä¸­ï¼Œä»–å‡­å€Ÿè‡ªå·±çš„æ™ºæ…§å’ŒåšéŸ§ï¼Œä¸ç‹±å‹ç‘å¾·å»ºç«‹äº†æ·±åšçš„å‹è°Šï¼Œå¹¶æœ€ç»ˆç­–åˆ’äº†ä¸€åœºéœ‡æƒŠæ‰€æœ‰äººçš„è¶Šç‹±ï¼Œé‡è·è‡ªç”±ã€‚"
                }
            ],
            users: [
                {
                    id: "user001",
                    username: "admin",
                    password: "admin123",
                    isAdmin: true,
                    avatar: "",
                    intro: "ç³»ç»Ÿç®¡ç†å‘˜",
                    collectedMovies: ["movie001", "movie004"],
                    watchedMovies: ["movie001", "movie002"],
                    toWatchMovies: ["movie003"],
                    myReviews: ["review001"]
                },
                {
                    id: "user002",
                    username: "testuser",
                    password: "test123",
                    isAdmin: false,
                    avatar: "",
                    intro: "æ™®é€šç”¨æˆ·ï¼Œå–œæ¬¢çœ‹ç”µå½±",
                    collectedMovies: ["movie002", "movie003"],
                    watchedMovies: ["movie002", "movie003"],
                    toWatchMovies: ["movie001", "movie004"],
                    myReviews: ["review002"]
                }
            ],
            reviews: [
                {
                    id: "review001",
                    userId: "user001",
                    movieId: "movie001",
                    username: "admin",
                    score: 5,
                    content: "æµæµªåœ°çƒ2ç»å¯¹æ˜¯ä¸­å›½ç§‘å¹»ç”µå½±çš„é‡Œç¨‹ç¢‘ä¹‹ä½œï¼ç‰¹æ•ˆéœ‡æ’¼ï¼Œå‰§æƒ…é¥±æ»¡ï¼Œå®¶å›½æƒ…æ€€ä¸äººç±»å‘½è¿çš„ä¸»é¢˜ç»“åˆå¾—éå¸¸å¥½ï¼Œå¼ºçƒˆæ¨èï¼",
                    likeCount: 128,
                    comments: ["åŒæ„ï¼æˆ‘ä¹Ÿè§‰å¾—è¶…å¥½çœ‹", "ç‰¹æ•ˆç¡®å®æ¯”ç¬¬ä¸€éƒ¨è¿›æ­¥å¾ˆå¤š"]
                },
                {
                    id: "review002",
                    userId: "user002",
                    movieId: "movie002",
                    username: "testuser",
                    score: 4,
                    content: "å¹³è¡Œå®‡å®™çš„è®¾å®šå¾ˆæœ‰åˆ›æ„ï¼Œç”»é¢é£æ ¼ç‹¬ç‰¹ï¼Œå°±æ˜¯å‰§æƒ…èŠ‚å¥æœ‰ç‚¹æ…¢ï¼Œæ•´ä½“è¿˜æ˜¯å¾ˆç²¾å½©çš„ï¼ŒæœŸå¾…ä¸‹ä¸€éƒ¨ï¼",
                    likeCount: 89,
                    comments: ["èŠ‚å¥æ…¢+1ï¼Œä½†ç”»é¢çœŸçš„ç»äº†", "æˆ‘è§‰å¾—èŠ‚å¥åˆšå¥½ï¼Œç»†èŠ‚å¾ˆå¤š"]
                }
            ],
            currentUser: null,
            currentMovie: null,
            authMode: "login" // "login" æˆ– "register"
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ•°æ®ï¼ˆä»localStorageè¯»å–æˆ–ä½¿ç”¨é»˜è®¤æ•°æ®ï¼‰
        window.onload = function() {
            const savedData = localStorage.getItem("movieReviewSystemData");
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                localStorage.setItem("movieReviewSystemData", JSON.stringify(appData));
            }
            renderMovieList(appData.movies);
            updateUserStatus();
            renderAdminTables();
        };

        // 1. ç”µå½±æµè§ˆæ¨¡å—åŠŸèƒ½
        // æ¸²æŸ“ç”µå½±åˆ—è¡¨
        function renderMovieList(movies) {
            const movieList = document.getElementById("movie-list");
            movieList.innerHTML = "";
            if (movies.length === 0) {
                movieList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç”µå½±</p>";
                return;
            }
            movies.forEach(movie => {
                const movieCard = document.createElement("div");
                movieCard.className = "movie-card";
                movieCard.innerHTML = `
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-score">â˜… ${movie.avgScore} (${movie.scoreCount}äººè¯„åˆ†)</div>
                        <div class="movie-tag">${movie.category} | ${movie.region} | ${movie.year}</div>
                        <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                    </div>
                `;
                movieList.appendChild(movieCard);
            });
        }

        // ç­›é€‰ç”µå½±
        function filterMovies() {
            const category = document.getElementById("category-filter").value;
            const region = document.getElementById("region-filter").value;
            const year = document.getElementById("year-filter").value;
            let filteredMovies = appData.movies;
            
            if (category !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.category.includes(category));
            }
            if (region !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.region === region);
            }
            if (year !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.year === year);
            }
            renderMovieList(filteredMovies);
        }

        // æœç´¢ç”µå½±
        function searchMovie() {
            const keyword = document.getElementById("search-input").value.trim().toLowerCase();
            if (!keyword) {
                renderMovieList(appData.movies);
                return;
            }
            const searchedMovies = appData.movies.filter(movie => 
                movie.title.toLowerCase().includes(keyword) ||
                movie.actors.toLowerCase().includes(keyword) ||
                movie.director.toLowerCase().includes(keyword)
            );
            renderMovieList(searchedMovies);
        }

        // æŸ¥çœ‹ç”µå½±è¯¦æƒ…ï¼ˆè·³è½¬è‡³è¯„ä»·äº’åŠ¨æ¨¡å—ï¼‰
        function showMovieDetail(movieId) {
            const movie = appData.movies.find(m => m.id === movieId);
            if (!movie) return;
            appData.currentMovie = movie;
            
            // æ˜¾ç¤ºè¯„ä»·äº’åŠ¨æ¨¡å—ï¼Œéšè—å…¶ä»–æ¨¡å—
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("review-module").classList.remove("hidden");
            
            // æ¸²æŸ“ç”µå½±è¯¦æƒ…
            const movieDetail = document.getElementById("movie-detail");
            movieDetail.innerHTML = `
                <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                    <img src="${movie.poster}" alt="${movie.title}" style="width: 220px; height: 330px; object-fit: cover; border-radius: 8px;">
                    <div style="flex: 1;">
                        <h2 style="margin-bottom: 15px;">${movie.title}</h2>
                        <p style="margin-bottom: 8px;"><strong>è¯„åˆ†ï¼š</strong>â˜… ${movie.avgScore} (${movie.scoreCount}äººè¯„åˆ†)</p>
                        <p style="margin-bottom: 8px;"><strong>ç±»åˆ«ï¼š</strong>${movie.category}</p>
                        <p style="margin-bottom: 8px;"><strong>åœ°åŒºï¼š</strong>${movie.region}</p>
                        <p style="margin-bottom: 8px;"><strong>å¹´ä»£ï¼š</strong>${movie.year}</p>
                        <p style="margin-bottom: 8px;"><strong>å¯¼æ¼”ï¼š</strong>${movie.director}</p>
                        <p style="margin-bottom: 8px;"><strong>æ¼”å‘˜ï¼š</strong>${movie.actors}</p>
                        <p style="margin-bottom: 8px;"><strong>ä¸Šæ˜ æ—¶é—´ï¼š</strong>${movie.releaseDate}</p>
                        <p style="margin-bottom: 8px;"><strong>ç‰‡é•¿ï¼š</strong>${movie.duration}åˆ†é’Ÿ</p>
                        <p style="margin-bottom: 15px;"><strong>ç®€ä»‹ï¼š</strong>${movie.intro}</p>
                        ${appData.currentUser ? `
                            <div style="display: flex; gap: 15px;">
                                <button class="admin-btn" onclick="collectMovie('${movie.id}')">
                                    ${appData.currentUser.collectedMovies.includes(movie.id) ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—ç”µå½±'}
                                </button>
                                <button class="admin-btn" onclick="addToWatchList('${movie.id}')">
                                    ${appData.currentUser.watchedMovies.includes(movie.id) ? 'å·²è§‚çœ‹' : (appData.currentUser.toWatchMovies.includes(movie.id) ? 'å–æ¶ˆå¾…çœ‹' : 'æ·»åŠ åˆ°å¾…çœ‹')}
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // æ¸²æŸ“å½±è¯„åˆ—è¡¨
            renderReviewList(movieId);
        }

        // 2. è¯„ä»·äº’åŠ¨æ¨¡å—åŠŸèƒ½
        // è®¾ç½®è¯„åˆ†
        function setScore(score) {
            const stars = document.querySelectorAll(".score-star");
            stars.forEach((star, index) => {
                if (index < score) {
                    star.classList.add("active");
                } else {
                    star.classList.remove("active");
                }
            });
            document.getElementById("selected-score").value = score;
        }

        // æäº¤å½±è¯„
        function submitReview() {
            if (!appData.currentUser) {
                alert("è¯·å…ˆç™»å½•åå†å‘è¡¨è¯„ä»·ï¼");
                showLoginModal();
                return;
            }
            const movieId = appData.currentMovie.id;
            const score = parseInt(document.getElementById("selected-score").value);
            const content = document.getElementById("review-content").value.trim();
            
            if (score === 0 || !content) {
                alert("è¯·é€‰æ‹©è¯„åˆ†å¹¶è¾“å…¥è¯„ä»·å†…å®¹ï¼");
                return;
            }
            
            // åˆ›å»ºæ–°å½±è¯„
            const reviewId = "review" + (appData.reviews.length + 1);
            const newReview = {
                id: reviewId,
                userId: appData.currentUser.id,
                username: appData.currentUser.username,
                movieId: movieId,
                score: score,
                content: content,
                likeCount: 0,
                comments: []
            };
            
            // æ›´æ–°æ•°æ®
            appData.reviews.push(newReview);
            appData.currentUser.myReviews.push(reviewId);
            
            // æ›´æ–°ç”µå½±è¯„åˆ†
            const movie = appData.movies.find(m => m.id === movieId);
            const totalScore = movie.avgScore * movie.scoreCount + score;
            movie.scoreCount += 1;
            movie.avgScore = (totalScore / movie.scoreCount).toFixed(1) * 1;
            
            // ä¿å­˜æ•°æ®å¹¶é‡æ–°æ¸²æŸ“
            saveData();
            renderReviewList(movieId);
            document.getElementById("selected-score").value = 0;
            document.getElementById("review-content").value = "";
            setScore(0);
            alert("è¯„ä»·æäº¤æˆåŠŸï¼");
        }

        // æ¸²æŸ“å½±è¯„åˆ—è¡¨
        function renderReviewList(movieId) {
            const reviewList = document.getElementById("review-list");
            const reviews = appData.reviews.filter(r => r.movieId === movieId);
            reviewList.innerHTML = "";
            
            if (reviews.length === 0) {
                reviewList.innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>æš‚æ— å½±è¯„ï¼Œå¿«æ¥å‘è¡¨ä½ çš„çœ‹æ³•å§ï¼</p>";
                return;
            }
            
            reviews.forEach(review => {
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item";
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-user">${review.username}</div>
                        <div class="review-score">â˜… ${review.score}</div>
                    </div>
                    <div class="review-content">${review.content}</div>
                    <div class="review-actions">
                        <div class="review-action" onclick="likeReview('${review.id}')">
                            <span>ğŸ‘</span> ${review.likeCount}
                        </div>
                        <div class="review-action" onclick="commentReview('${review.id}')">
                            <span>ğŸ’¬</span> è¯„è®º (${review.comments.length})
                        </div>
                        ${appData.currentUser && (appData.currentUser.isAdmin || appData.currentUser.id === review.userId) ? `
                            <div class="review-action" style="color: #e74c3c;" onclick="deleteReview('${review.id}')">
                                åˆ é™¤
                            </div>
                        ` : ''}
                    </div>
                `;
                reviewList.appendChild(reviewItem);
            });
        }

        // ç‚¹èµå½±è¯„
        function likeReview(reviewId) {
            if (!appData.currentUser) {
                alert("è¯·å…ˆç™»å½•åå†ç‚¹èµï¼");
                showLoginModal();
                return;
            }
            const review = appData.reviews.find(r => r.id === reviewId);
            review.likeCount += 1;
            saveData();
            renderReviewList(appData.currentMovie.id);
        }

        // è¯„è®ºå½±è¯„ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…å¯æ‰©å±•ä¸ºå¼¹çª—è¾“å…¥ï¼‰
        function commentReview(reviewId) {
            if (!appData.currentUser) {
                alert("è¯·å…ˆç™»å½•åå†è¯„è®ºï¼");
                showLoginModal();
                return;
            }
            const comment = prompt("è¯·è¾“å…¥ä½ çš„è¯„è®ºï¼š");
            if (comment && comment.trim()) {
                const review = appData.reviews.find(r => r.id === reviewId);
                review.comments.push(comment.trim());
                saveData();
                renderReviewList(appData.currentMovie.id);
            }
        }

        // åˆ é™¤å½±è¯„
        function deleteReview(reviewId) {
            const confirmDelete = confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡å½±è¯„å—ï¼Ÿ");
            if (!confirmDelete) return;
            
            // æ‰¾åˆ°å½±è¯„å¹¶æ›´æ–°æ•°æ®
            const reviewIndex = appData.reviews.findIndex(r => r.id === reviewId);
            const review = appData.reviews[reviewIndex];
            appData.reviews.splice(reviewIndex, 1);
            
            // ä»ç”¨æˆ·çš„å½±è¯„åˆ—è¡¨ä¸­ç§»é™¤
            const user = appData.users.find(u => u.id === review.userId);
            const reviewUserIndex = user.myReviews.findIndex(id => id === reviewId);
            if (reviewUserIndex !== -1) {
                user.myReviews.splice(reviewUserIndex, 1);
            }
            
            // æ›´æ–°ç”µå½±è¯„åˆ†ï¼ˆç®€åŒ–ï¼šä¸å›é€€è¯„åˆ†ï¼Œå®é™…å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰
            const movie = appData.movies.find(m => m.id === review.movieId);
            movie.scoreCount -= 1;
            if (movie.scoreCount === 0) {
                movie.avgScore = 0;
            } else {
                const totalScore = movie.avgScore * (movie.scoreCount + 1) - review.score;
                movie.avgScore = (totalScore / movie.scoreCount).toFixed(1) * 1;
            }
            
            // ä¿å­˜æ•°æ®å¹¶é‡æ–°æ¸²æŸ“
            saveData();
            renderReviewList(review.movieId);
        }

        // 3. ç”¨æˆ·ä¸­å¿ƒæ¨¡å—åŠŸèƒ½
        // åˆ‡æ¢ç”¨æˆ·ä¸­å¿ƒæ ‡ç­¾
        function showUserTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾
            document.querySelectorAll(".user-tab").forEach(tab => tab.classList.add("hidden"));
            document.querySelectorAll(".sidebar-item").forEach(item => item.classList.remove("active"));
            
            // æ˜¾ç¤ºé€‰ä¸­æ ‡ç­¾
            document.getElementById(`${tabName}-tab`).classList.remove("hidden");
            document.querySelector(`.sidebar-item[onclick="showUserTab('${tabName}')"]`).classList.add("active");
            
            // æ¸²æŸ“å¯¹åº”å†…å®¹
            if (tabName === "my-reviews") {
                renderMyReviews();
            } else if (tabName === "collected") {
                renderCollectedMovies();
            } else if (tabName === "watch-list") {
                renderWatchList();
            }
        }

        // æ¸²æŸ“æˆ‘çš„å½±è¯„
        function renderMyReviews() {
            const myReviewsList = document.getElementById("my-reviews-list");
            const myReviews = appData.reviews.filter(r => appData.currentUser.myReviews.includes(r.id));
            myReviewsList.innerHTML = "";
            
            if (myReviews.length === 0) {
                myReviewsList.innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>ä½ è¿˜æ²¡æœ‰å‘è¡¨è¿‡å½±è¯„</p>";
                return;
            }
            
            myReviews.forEach(review => {
                const movie = appData.movies.find(m => m.id === review.movieId);
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item";
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-user">${movie.title}</div>
                        <div class="review-score">â˜… ${review.score}</div>
                    </div>
                    <div class="review-content">${review.content}</div>
                    <div class="review-actions">
                        <div class="review-action">
                            <span>ğŸ‘</span> ${review.likeCount}
                        </div>
                        <div class="review-action">
                            <span>ğŸ’¬</span> ${review.comments.length}
                        </div>
                        <div class="review-action" style="color: #e74c3c;" onclick="deleteReview('${review.id}')">
                            åˆ é™¤
                        </div>
                    </div>
                `;
                myReviewsList.appendChild(reviewItem);
            });
        }

        // æ¸²æŸ“æ”¶è—ç”µå½±
        function renderCollectedMovies() {
            const collectedList = document.getElementById("collected-list");
            const collectedMovies = appData.movies.filter(m => appData.currentUser.collectedMovies.includes(m.id));
            collectedList.innerHTML = "";
            
            if (collectedMovies.length === 0) {
                collectedList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>ä½ è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•ç”µå½±</p>";
                return;
            }
            
            collectedMovies.forEach(movie => {
                const movieCard = document.createElement("div");
                movieCard.className = "movie-card";
                movieCard.innerHTML = `
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-score">â˜… ${movie.avgScore}</div>
                        <div class="movie-tag">${movie.category}</div>
                        <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                        <button class="movie-btn" style="margin-top: 8px; background-color: #e74c3c;" onclick="collectMovie('${movie.id}')">å–æ¶ˆæ”¶è—</button>
                    </div>
                `;
                collectedList.appendChild(movieCard);
            });
        }

        // æ¸²æŸ“è§‚å½±æ¸…å•
        function renderWatchList() {
            // å·²çœ‹ç”µå½±
            const watchedList = document.getElementById("watched-list");
            const watchedMovies = appData.movies.filter(m => appData.currentUser.watchedMovies.includes(m.id));
            watchedList.innerHTML = "";
            
            if (watchedMovies.length === 0) {
                watchedList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>ä½ è¿˜æ²¡æœ‰æ ‡è®°ä»»ä½•å·²çœ‹ç”µå½±</p>";
            } else {
                watchedMovies.forEach(movie => {
                    const movieCard = document.createElement("div");
                    movieCard.className = "movie-card";
                    movieCard.innerHTML = `
                        <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-score">â˜… ${movie.avgScore}</div>
                            <div class="movie-tag">${movie.category}</div>
                            <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                            <button class="movie-btn" style="margin-top: 8px; background-color: #95a5a6;" onclick="addToWatchList('${movie.id}')">å–æ¶ˆå·²çœ‹</button>
                        </div>
                    `;
                    watchedList.appendChild(movieCard);
                });
            }
            
            // å¾…çœ‹ç”µå½±
            const toWatchList = document.getElementById("to-watch-list");
            const toWatchMovies = appData.movies.filter(m => appData.currentUser.toWatchMovies.includes(m.id));
            toWatchList.innerHTML = "";
            
            if (toWatchMovies.length === 0) {
                toWatchList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>ä½ è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å¾…çœ‹ç”µå½±</p>";
            } else {
                toWatchMovies.forEach(movie => {
                    const movieCard = document.createElement("div");
                    movieCard.className = "movie-card";
                    movieCard.innerHTML = `
                        <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-score">â˜… ${movie.avgScore}</div>
                            <div class="movie-tag">${movie.category}</div>
                            <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                            <button class="movie-btn" style="margin-top: 8px; background-color: #2ecc71;" onclick="markAsWatched('${movie.id}')">æ ‡è®°ä¸ºå·²çœ‹</button>
                        </div>
                    `;
                    toWatchList.appendChild(movieCard);
                });
            }
        }

        // æ”¶è—/å–æ¶ˆæ”¶è—ç”µå½±
        function collectMovie(movieId) {
            const user = appData.currentUser;
            const index = user.collectedMovies.findIndex(id => id === movieId);
            
            if (index === -1) {
                user.collectedMovies.push(movieId);
                alert("ç”µå½±æ”¶è—æˆåŠŸï¼");
            } else {
                user.collectedMovies.splice(index, 1);
                alert("ç”µå½±å–æ¶ˆæ”¶è—æˆåŠŸï¼");
            }
            
            saveData();
            if (document.getElementById("collected-tab").classList.contains("active")) {
                renderCollectedMovies();
            }
            if (appData.currentMovie) {
                showMovieDetail(movieId);
            }
        }

        // æ·»åŠ /å–æ¶ˆå¾…çœ‹ç”µå½±
        function addToWatchList(movieId) {
            const user = appData.currentUser;
            const watchedIndex = user.watchedMovies.findIndex(id => id === movieId);
            const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
            
            if (watchedIndex !== -1) {
                alert("è¯¥ç”µå½±å·²æ ‡è®°ä¸ºå·²çœ‹ï¼Œæ— æ³•æ·»åŠ åˆ°å¾…çœ‹æ¸…å•ï¼");
                return;
            }
            
            if (toWatchIndex === -1) {
                user.toWatchMovies.push(movieId);
                alert("ç”µå½±æ·»åŠ åˆ°å¾…çœ‹æ¸…å•æˆåŠŸï¼");
            } else {
                user.toWatchMovies.splice(toWatchIndex, 1);
                alert("ç”µå½±ä»å¾…çœ‹æ¸…å•ç§»é™¤æˆåŠŸï¼");
            }
            
            saveData();
            if (document.getElementById("watch-list-tab").classList.contains("active")) {
                renderWatchList();
            }
            if (appData.currentMovie) {
                showMovieDetail(movieId);
            }
        }

        // æ ‡è®°ç”µå½±ä¸ºå·²çœ‹
        function markAsWatched(movieId) {
            const user = appData.currentUser;
            const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
            
            if (toWatchIndex !== -1) {
                user.toWatchMovies.splice(toWatchIndex, 1);
                user.watchedMovies.push(movieId);
                alert("ç”µå½±æ ‡è®°ä¸ºå·²çœ‹æˆåŠŸï¼");
                saveData();
                renderWatchList();
            }
        }

        // ä¿å­˜ä¸ªäººèµ„æ–™
        function saveProfile() {
            const intro = document.getElementById("user-intro").value.trim();
            appData.currentUser.intro = intro;
            saveData();
            alert("ä¸ªäººèµ„æ–™ä¿å­˜æˆåŠŸï¼");
        }

        // 4. ç®¡ç†å‘˜æ¨¡å—åŠŸèƒ½
        // æ¸²æŸ“ç®¡ç†å‘˜è¡¨æ ¼
        function renderAdminTables() {
            // ç”µå½±è¡¨æ ¼
            const movieTable = document.getElementById("admin-movie-table");
            movieTable.innerHTML = "";
            appData.movies.forEach(movie => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${movie.id}</td>
                    <td>${movie.title}</td>
                    <td>${movie.category}</td>
                    <td>${movie.region}</td>
                    <td>
                        <button class="admin-btn edit-btn" onclick="editMovie('${movie.id}')">ç¼–è¾‘</button>
                        <button class="admin-btn delete-btn" onclick="deleteMovie('${movie.id}')">åˆ é™¤</button>
                    </td>
                `;
                movieTable.appendChild(row);
            });
            
            // å½±è¯„è¡¨æ ¼
            const reviewTable = document.getElementById("admin-review-table");
            reviewTable.innerHTML = "";
            appData.reviews.forEach(review => {
                const movie = appData.movies.find(m => m.id === review.movieId);
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${review.id}</td>
                    <td>${review.username}</td>
                    <td>${movie ? movie.title : 'æœªçŸ¥ç”µå½±'}</td>
                    <td style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${review.content}</td>
                    <td>
                        <button class="admin-btn delete-btn" onclick="deleteReview('${review.id}')">åˆ é™¤</button>
                    </td>
                `;
                reviewTable.appendChild(row);
            });
            
            // ç”¨æˆ·è¡¨æ ¼
            const userTable = document.getElementById("admin-user-table");
            userTable.innerHTML = "";
            appData.users.forEach(user => {
                if (user.username === "admin") return; // ä¸å…è®¸æ“ä½œç®¡ç†å‘˜è´¦å·
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>
                        <button class="admin-btn delete-btn" onclick="deleteUser('${user.id}')">å°ç¦è´¦å·</button>
                    </td>
                `;
                userTable.appendChild(row);
            });
        }

        // æ·»åŠ ç”µå½±
        function addMovie() {
            const title = document.getElementById("movie-title").value.trim();
            const category = document.getElementById("movie-category").value.trim();
            const region = document.getElementById("movie-region").value.trim();
            const year = document.getElementById("movie-year").value.trim();
            const director = document.getElementById("movie-director").value.trim();
            const actors = document.getElementById("movie-actors").value.trim();
            const releaseDate = document.getElementById("movie-release").value.trim();
            const duration = parseInt(document.getElementById("movie-duration").value);
            const intro = document.getElementById("movie-intro").value.trim();
            
            if (!title || !category || !region || !year || !director || !actors || !releaseDate || !duration || !intro) {
                alert("è¯·å¡«å†™æ‰€æœ‰ç”µå½±ä¿¡æ¯ï¼");
                return;
            }
            
            // åˆ›å»ºæ–°ç”µå½±
            const movieId = "movie" + (appData.movies.length + 1);
            const newMovie = {
                id: movieId,
                title: title,
                poster: "https://via.placeholder.com/200x300?text=æš‚æ— æµ·æŠ¥",
                avgScore: 0,
                scoreCount: 0,
                category: category,
                region: region,
                year: year,
                director: director,
                actors: actors,
                releaseDate: releaseDate,
                duration: duration,
                intro: intro
            };
            
            appData.movies.push(newMovie);
            saveData();
            renderAdminTables();
            renderMovieList(appData.movies);
            closeModal();
            document.getElementById("add-movie-form").reset();
            alert("ç”µå½±æ·»åŠ æˆåŠŸï¼");
        }

        // ç¼–è¾‘ç”µå½±ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…å¯æ‰©å±•ä¸ºå¼¹çª—ä¿®æ”¹ï¼‰
        function editMovie(movieId) {
            const movie = appData.movies.find(m => m.id === movieId);
            const newTitle = prompt("è¯·è¾“å…¥æ–°çš„ç”µå½±æ ‡é¢˜ï¼ˆå½“å‰ï¼š" + movie.title + "ï¼‰ï¼š");
            if (newTitle && newTitle.trim()) {
                movie.title = newTitle.trim();
                saveData();
                renderAdminTables();
                renderMovieList(appData.movies);
                alert("ç”µå½±æ ‡é¢˜ä¿®æ”¹æˆåŠŸï¼");
            }
        }

        // åˆ é™¤ç”µå½±
        function deleteMovie(movieId) {
            const confirmDelete = confirm("ç¡®å®šè¦åˆ é™¤è¯¥ç”µå½±å—ï¼Ÿåˆ é™¤åç›¸å…³å½±è¯„ä¹Ÿä¼šè¢«åˆ é™¤ï¼");
            if (!confirmDelete) return;
            
            // åˆ é™¤ç”µå½±
            const movieIndex = appData.movies.findIndex(m => m.id === movieId);
            appData.movies.splice(movieIndex, 1);
            
            // åˆ é™¤ç›¸å…³å½±è¯„
            const reviewsToDelete = appData.reviews.filter(r => r.movieId === movieId);
            reviewsToDelete.forEach(review => {
                const reviewIndex = appData.reviews.findIndex(r => r.id === review.id);
                appData.reviews.splice(reviewIndex, 1);
                
                // ä»ç”¨æˆ·å½±è¯„åˆ—è¡¨ä¸­ç§»é™¤
                const user = appData.users.find(u => u.id === review.userId);
                const userReviewIndex = user.myReviews.findIndex(id => id === review.id);
                if (userReviewIndex !== -1) {
                    user.myReviews.splice(userReviewIndex, 1);
                }
            });
            
            // ä»ç”¨æˆ·æ”¶è—å’Œè§‚å½±æ¸…å•ä¸­ç§»é™¤
            appData.users.forEach(user => {
                const collectedIndex = user.collectedMovies.findIndex(id => id === movieId);
                if (collectedIndex !== -1) user.collectedMovies.splice(collectedIndex, 1);
                
                const watchedIndex = user.watchedMovies.findIndex(id => id === movieId);
                if (watchedIndex !== -1) user.watchedMovies.splice(watchedIndex, 1);
                
                const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
                if (toWatchIndex !== -1) user.toWatchMovies.splice(toWatchIndex, 1);
            });
            
            saveData();
            renderAdminTables();
            renderMovieList(appData.movies);
            alert("ç”µå½±åˆ é™¤æˆåŠŸï¼");
        }

        // åˆ é™¤ç”¨æˆ·ï¼ˆå°ç¦è´¦å·ï¼‰
        function deleteUser(userId) {
            const confirmDelete = confirm("ç¡®å®šè¦å°ç¦è¯¥ç”¨æˆ·è´¦å·å—ï¼Ÿç”¨æˆ·çš„å½±è¯„å’Œæ”¶è—ä¼šè¢«ä¿ç•™ï¼");
            if (!confirmDelete) return;
            
            // ä»ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤ï¼ˆç®€åŒ–ï¼šå®é™…å¯æ”¹ä¸ºæ ‡è®°ä¸ºå°ç¦çŠ¶æ€ï¼‰
            const userIndex = appData.users.findIndex(u => u.id === userId);
            appData.users.splice(userIndex, 1);
            
            // å¦‚æœå½“å‰ç™»å½•ç”¨æˆ·æ˜¯è¢«å°ç¦çš„ç”¨æˆ·ï¼Œå¼ºåˆ¶é€€å‡º
            if (appData.currentUser && appData.currentUser.id === userId) {
                logout();
            }
            
            saveData();
            renderAdminTables();
            alert("ç”¨æˆ·è´¦å·å°ç¦æˆåŠŸï¼");
        }

        // 5. ç™»å½•/æ³¨å†ŒåŠŸèƒ½
        // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
        function showLoginModal() {
            appData.authMode = "login";
            document.getElementById("modal-title").textContent = "ç”¨æˆ·ç™»å½•";
            document.querySelector("#auth-form button").textContent = "ç™»å½•";
            document.getElementById("login-modal").style.display = "flex";
        }

        // åˆ‡æ¢ç™»å½•/æ³¨å†Œæ¨¡å¼
        function toggleAuthMode() {
            appData.authMode = appData.authMode === "login" ? "register" : "login";
            const title = appData.authMode === "login" ? "ç”¨æˆ·ç™»å½•" : "ç”¨æˆ·æ³¨å†Œ";
            const btnText = appData.authMode === "login" ? "ç™»å½•" : "æ³¨å†Œ";
            const toggleText = appData.authMode === "login" ? "è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ" : "å·²æœ‰è´¦å·ï¼Ÿç‚¹å‡»ç™»å½•";
            
            document.getElementById("modal-title").textContent = title;
            document.querySelector("#auth-form button").textContent = btnText;
            document.querySelector("#auth-form p").textContent = toggleText;
        }

        // æäº¤ç™»å½•/æ³¨å†Œ
        function submitAuth() {
            const username = document.getElementById("auth-username").value.trim();
            const password = document.getElementById("auth-password").value.trim();
            
            if (appData.authMode === "login") {
                // ç™»å½•
                const user = appData.users.find(u => u.username === username && u.password === password);
                if (user) {
                    appData.currentUser = user;
                    saveData();
                    updateUserStatus();
                    closeModal();
                    alert("ç™»å½•æˆåŠŸï¼");
                } else {
                    alert("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼");
                }
            } else {
                // æ³¨å†Œ
                const userExists = appData.users.some(u => u.username === username);
                if (userExists) {
                    alert("ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·æ›´æ¢ç”¨æˆ·åï¼");
                    return;
                }
                if (password.length < 6) {
                    alert("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼");
                    return;
                }
                
                // åˆ›å»ºæ–°ç”¨æˆ·
                const userId = "user" + (appData.users.length + 1);
                const newUser = {
                    id: userId,
                    username: username,
                    password: password,
                    isAdmin: false,
                    avatar: "",
                    intro: "",
                    collectedMovies: [],
                    watchedMovies: [],
                    toWatchMovies: [],
                    myReviews: []
                };
                
                appData.users.push(newUser);
                appData.currentUser = newUser;
                saveData();
                updateUserStatus();
                closeModal();
                document.getElementById("auth-form").reset();
                alert("æ³¨å†ŒæˆåŠŸï¼");
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            appData.currentUser = null;
            saveData();
            updateUserStatus();
            // å›åˆ°ç”µå½±æµè§ˆæ¨¡å—
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("movie-module").classList.remove("hidden");
        }

        // æ›´æ–°ç”¨æˆ·ç™»å½•çŠ¶æ€
        function updateUserStatus() {
            const loginText = document.getElementById("login-text");
            const loginBtn = document.getElementById("login-btn");
            const userAvatar = document.getElementById("user-avatar");
            const logoutBtn = document.getElementById("logout-btn");
            const navReview = document.getElementById("nav-review");
            const navUser = document.getElementById("nav-user");
            const navAdmin = document.getElementById("nav-admin");
            
            if (appData.currentUser) {
                // å·²ç™»å½•
                loginText.textContent = appData.currentUser.username;
                loginText.style.display = "inline-block";
                loginBtn.style.display = "none";
                userAvatar.classList.remove("hidden");
                logoutBtn.classList.remove("hidden");
                navReview.classList.remove("hidden");
                navUser.classList.remove("hidden");
                
                // ç®¡ç†å‘˜æ˜¾ç¤ºåå°å…¥å£
                if (appData.currentUser.isAdmin) {
                    navAdmin.classList.remove("hidden");
                } else {
                    navAdmin.classList.add("hidden");
                }
                
                // æ›´æ–°å¤´åƒåˆå§‹å­—æ¯
                document.getElementById("avatar-initial").textContent = appData.currentUser.username[0].toUpperCase();
                document.getElementById("profile-initial").textContent = appData.currentUser.username[0].toUpperCase();
                document.getElementById("username").value = appData.currentUser.username;
                document.getElementById("user-intro").value = appData.currentUser.intro;
            } else {
                // æœªç™»å½•
                loginText.textContent = "æœªç™»å½•";
                loginBtn.style.display = "inline-block";
                userAvatar.classList.add("hidden");
                logoutBtn.classList.add("hidden");
                navReview.classList.add("hidden");
                navUser.classList.add("hidden");
                navAdmin.classList.add("hidden");
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById("login-modal").style.display = "none";
            document.getElementById("add-movie-modal").style.display = "none";
            document.getElementById("auth-form").reset();
        }

        // æ˜¾ç¤ºæ·»åŠ ç”µå½±æ¨¡æ€æ¡†
        function showAddMovieModal() {
            document.getElementById("add-movie-modal").style.display = "flex";
        }

        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveData() {
            localStorage.setItem("movieReviewSystemData", JSON.stringify(appData));
        }

        // å¯¼èˆªæ åˆ‡æ¢æ¨¡å—
        document.getElementById("nav-movie").onclick = function() {
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("movie-module").classList.remove("hidden");
        };

        document.getElementById("nav-review").onclick = function() {
            if (!appData.currentUser) {
                alert("è¯·å…ˆç™»å½•åå†è¿›å…¥è¯„ä»·äº’åŠ¨æ¨¡å—ï¼");
                showLoginModal();
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("review-module").classList.remove("hidden");
            if (appData.currentMovie) {
                showMovieDetail(appData.currentMovie.id);
            } else {
                document.getElementById("movie-detail").innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>è¯·å…ˆä»ç”µå½±æµè§ˆæ¨¡å—é€‰æ‹©ä¸€éƒ¨ç”µå½±æŸ¥çœ‹è¯¦æƒ…</p>";
                document.getElementById("review-list").innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>æš‚æ— å½±è¯„</p>";
            }
        };

        document.getElementById("nav-user").onclick = function() {
            if (!appData.currentUser) {
                alert("è¯·å…ˆç™»å½•åå†è¿›å…¥ç”¨æˆ·ä¸­å¿ƒï¼");
                showLoginModal();
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("user-module").classList.remove("hidden");
            showUserTab("profile"); // é»˜è®¤æ˜¾ç¤ºä¸ªäººèµ„æ–™
        };

        document.getElementById("nav-admin").onclick = function() {
            if (!appData.currentUser || !appData.currentUser.isAdmin) {
                alert("æ— ç®¡ç†å‘˜æƒé™ï¼Œæ— æ³•è¿›å…¥ç®¡ç†å‘˜åå°ï¼");
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.remove("hidden");
            renderAdminTables();
        };

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
        window.onclick = function(event) {
            const loginModal = document.getElementById("login-modal");
            const addMovieModal = document.getElementById("add-movie-modal");
            if (event.target === loginModal) {
                closeModal();
            }
            if (event.target === addMovieModal) {
                closeModal();
            }
        };

        // ç»‘å®šç­›é€‰ä¸‹æ‹‰æ¡†å˜åŒ–äº‹ä»¶
        document.getElementById("category-filter").onchange = filterMovies;
        document.getElementById("region-filter").onchange = filterMovies;
        document.getElementById("year-filter").onchange = filterMovies;
    </script>
</body>
</html>
