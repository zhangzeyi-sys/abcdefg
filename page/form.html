<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线电影评价系统</title>
    <style>
        /* 全局样式重置与基础设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }
        /* 导航栏样式 */
        .nav {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-logo {
            font-size: 24px;
            font-weight: bold;
        }
        .nav-menu {
            display: flex;
            gap: 30px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 16px;
        }
        .nav-menu a:hover {
            color: #3498db;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        /* 模块通用样式 */
        .module {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        .module-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
            padding-left: 10px;
        }
        /* 电影列表样式 */
        .movie-list {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
        }
        .movie-card {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .movie-card:hover {
            transform: translateY(-5px);
        }
        .movie-poster {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }
        .movie-info {
            padding: 15px;
        }
        .movie-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .movie-score {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .movie-tag {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .movie-btn {
            width: 100%;
            padding: 8px 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .movie-btn:hover {
            background-color: #2980b9;
        }
        /* 筛选与搜索样式 */
        .filter-search {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: center;
        }
        .filter-group {
            display: flex;
            gap: 15px;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-box {
            display: flex;
            margin-left: auto;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 280px;
            font-size: 14px;
        }
        .search-btn {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        /* 影评互动样式 */
        .review-section {
            margin-top: 30px;
        }
        .review-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }
        .score-input {
            margin-bottom: 15px;
            font-size: 14px;
        }
        .score-star {
            color: #ddd;
            font-size: 20px;
            cursor: pointer;
        }
        .score-star.active {
            color: #f39c12;
        }
        .submit-review {
            padding: 10px 20px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .review-list {
            margin-top: 30px;
        }
        .review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .review-user {
            font-weight: bold;
        }
        .review-score {
            color: #e74c3c;
        }
        .review-actions {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #7f8c8d;
        }
        .review-action {
            cursor: pointer;
        }
        .review-action:hover {
            color: #3498db;
        }
        /* 用户中心样式 */
        .user-center {
            display: flex;
            gap: 30px;
        }
        .user-sidebar {
            width: 220px;
        }
        .sidebar-item {
            padding: 12px 15px;
            background-color: #f5f5f5;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .sidebar-item.active {
            background-color: #3498db;
            color: white;
        }
        .sidebar-item:hover:not(.active) {
            background-color: #eee;
        }
        .user-content {
            flex: 1;
        }
        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-label {
            font-size: 14px;
            font-weight: bold;
        }
        .form-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .save-profile {
            width: 120px;
            padding: 10px 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        /* 管理员模块样式 */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
        }
        .admin-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        .admin-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin-right: 8px;
        }
        .edit-btn {
            background-color: #f39c12;
            color: white;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        .approve-btn {
            background-color: #2ecc71;
            color: white;
        }
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }
        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        /* 隐藏模块样式 */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div class="nav">
        <div class="container nav-content">
            <div class="nav-logo">在线电影评价系统</div>
            <div class="nav-menu">
                <a href="#" id="nav-movie">电影浏览</a>
                <a href="#" id="nav-review" class="hidden">评价互动</a>
                <a href="#" id="nav-user" class="hidden">用户中心</a>
                <a href="#" id="nav-admin" class="hidden">管理员后台</a>
            </div>
            <div class="user-info">
                <span id="login-text">未登录</span>
                <button id="login-btn" onclick="showLoginModal()">登录/注册</button>
                <div class="user-avatar hidden" id="user-avatar" onclick="showUserMenu()">
                    <span id="avatar-initial">U</span>
                </div>
                <button id="logout-btn" class="hidden" onclick="logout()">退出登录</button>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="container">
        <!-- 1. 电影浏览模块 -->
        <div class="module" id="movie-module">
            <div class="module-title">电影浏览</div>
            <!-- 筛选与搜索 -->
            <div class="filter-search">
                <div class="filter-group">
                    <select class="filter-select" id="category-filter">
                        <option value="all">全部类别</option>
                        <option value="动作">动作</option>
                        <option value="喜剧">喜剧</option>
                        <option value="科幻">科幻</option>
                        <option value="爱情">爱情</option>
                        <option value="悬疑">悬疑</option>
                    </select>
                    <select class="filter-select" id="region-filter">
                        <option value="all">全部地区</option>
                        <option value="中国">中国</option>
                        <option value="美国">美国</option>
                        <option value="日本">日本</option>
                        <option value="韩国">韩国</option>
                    </select>
                    <select class="filter-select" id="year-filter">
                        <option value="all">全部年代</option>
                        <option value="20世纪90年代">20世纪90年代</option>
                        <option value="21世纪10年代">21世纪10年代</option>
                        <option value="21世纪20年代">21世纪20年代</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" placeholder="搜索电影名称/演员/导演...">
                    <button class="search-btn" onclick="searchMovie()">搜索</button>
                </div>
            </div>
            <!-- 电影列表 -->
            <div class="movie-list" id="movie-list">
                <!-- 电影卡片将通过JS动态生成 -->
            </div>
        </div>

        <!-- 2. 评价互动模块（默认隐藏） -->
        <div class="module hidden" id="review-module">
            <div class="module-title">评价互动</div>
            <div id="movie-detail">
                <!-- 电影详情将通过JS动态生成 -->
            </div>
            <!-- 影评发布区 -->
            <div class="review-section">
                <h3>发表你的评价</h3>
                <div class="score-input">
                    <span>评分：</span>
                    <span class="score-star" onclick="setScore(1)">★</span>
                    <span class="score-star" onclick="setScore(2)">★</span>
                    <span class="score-star" onclick="setScore(3)">★</span>
                    <span class="score-star" onclick="setScore(4)">★</span>
                    <span class="score-star" onclick="setScore(5)">★</span>
                    <input type="hidden" id="selected-score" value="0">
                </div>
                <textarea class="review-input" id="review-content" placeholder="分享你对这部电影的看法..."></textarea>
                <button class="submit-review" onclick="submitReview()">提交评价</button>
            </div>
            <!-- 影评列表 -->
            <div class="review-list" id="review-list">
                <!-- 影评将通过JS动态生成 -->
            </div>
        </div>

        <!-- 3. 用户中心模块（默认隐藏） -->
        <div class="module hidden" id="user-module">
            <div class="module-title">用户中心</div>
            <div class="user-center">
                <div class="user-sidebar">
                    <div class="sidebar-item active" onclick="showUserTab('profile')">个人资料</div>
                    <div class="sidebar-item" onclick="showUserTab('my-reviews')">我的影评</div>
                    <div class="sidebar-item" onclick="showUserTab('collected')">我的收藏</div>
                    <div class="sidebar-item" onclick="showUserTab('watch-list')">观影清单</div>
                </div>
                <div class="user-content">
                    <!-- 个人资料 -->
                    <div class="user-tab active" id="profile-tab">
                        <form class="profile-form">
                            <div class="form-group">
                                <label class="form-label">用户名</label>
                                <input type="text" class="form-input" id="username" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">个人简介</label>
                                <textarea class="form-input" id="user-intro" rows="3" placeholder="请输入个人简介..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">头像（模拟）</label>
                                <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;">
                                    <span id="profile-initial">U</span>
                                </div>
                            </div>
                            <button type="button" class="save-profile" onclick="saveProfile()">保存资料</button>
                        </form>
                    </div>
                    <!-- 我的影评 -->
                    <div class="user-tab hidden" id="my-reviews-tab">
                        <div id="my-reviews-list">
                            <!-- 我的影评将通过JS动态生成 -->
                        </div>
                    </div>
                    <!-- 我的收藏 -->
                    <div class="user-tab hidden" id="collected-tab">
                        <div class="movie-list" id="collected-list">
                            <!-- 收藏电影将通过JS动态生成 -->
                        </div>
                    </div>
                    <!-- 观影清单 -->
                    <div class="user-tab hidden" id="watch-list-tab">
                        <div class="movie-list" id="watched-list">
                            <!-- 已看电影将通过JS动态生成 -->
                        </div>
                        <div class="module-title" style="margin-top: 30px;">待看电影</div>
                        <div class="movie-list" id="to-watch-list">
                            <!-- 待看电影将通过JS动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. 管理员模块（默认隐藏） -->
        <div class="module hidden" id="admin-module">
            <div class="module-title">管理员后台</div>
            <!-- 电影信息管理 -->
            <div class="admin-section">
                <h3>电影信息管理</h3>
                <button class="admin-btn edit-btn" onclick="showAddMovieModal()">添加电影</button>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>电影ID</th>
                            <th>标题</th>
                            <th>类别</th>
                            <th>地区</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="admin-movie-table">
                        <!-- 电影数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <!-- 影评审核 -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3>影评审核</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>影评ID</th>
                            <th>用户</th>
                            <th>电影</th>
                            <th>内容</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="admin-review-table">
                        <!-- 影评数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <!-- 用户账号管理 -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3>用户账号管理</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>用户ID</th>
                            <th>用户名</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="admin-user-table">
                        <!-- 用户数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 登录/注册模态框 -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">用户登录</div>
                <span class="close-modal" onclick="closeModal()">×</span>
            </div>
            <div class="modal-body">
                <form id="auth-form">
                    <div class="form-group">
                        <label class="form-label">用户名</label>
                        <input type="text" class="form-input" id="auth-username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">密码</label>
                        <input type="password" class="form-input" id="auth-password" required>
                    </div>
                    <button type="button" class="submit-review" onclick="submitAuth()">登录</button>
                    <p style="margin-top: 15px; text-align: center; cursor: pointer;" onclick="toggleAuthMode()">
                        还没有账号？点击注册
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- 添加电影模态框 -->
    <div class="modal" id="add-movie-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">添加新电影</div>
                <span class="close-modal" onclick="closeModal()">×</span>
            </div>
            <div class="modal-body">
                <form id="add-movie-form">
                    <div class="form-group">
                        <label class="form-label">电影标题</label>
                        <input type="text" class="form-input" id="movie-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">类别</label>
                        <input type="text" class="form-input" id="movie-category" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">地区</label>
                        <input type="text" class="form-input" id="movie-region" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">年代</label>
                        <input type="text" class="form-input" id="movie-year" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">导演</label>
                        <input type="text" class="form-input" id="movie-director" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">演员</label>
                        <input type="text" class="form-input" id="movie-actors" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">上映时间</label>
                        <input type="text" class="form-input" id="movie-release" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">片长（分钟）</label>
                        <input type="number" class="form-input" id="movie-duration" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">电影简介</label>
                        <textarea class="form-input" id="movie-intro" rows="3" required></textarea>
                    </div>
                    <button type="button" class="submit-review" onclick="addMovie()">添加电影</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 全局数据（模拟数据库，使用localStorage持久化）
        let appData = {
            movies: [
                {
                    id: "movie001",
                    title: "流浪地球2",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2966788698.jpg",
                    avgScore: 8.3,
                    scoreCount: 123456,
                    category: "科幻/灾难",
                    region: "中国",
                    year: "21世纪20年代",
                    director: "郭帆",
                    actors: "吴京,刘德华,李雪健",
                    releaseDate: "2023-01-22",
                    duration: 173,
                    intro: "太阳即将毁灭，人类在地球表面建造出巨大的推进器，寻找新的家园。然而宇宙之路危机四伏，为了拯救地球，流浪地球时代的年轻人再次挺身而出，展开争分夺秒的生死之战。"
                },
                {
                    id: "movie002",
                    title: "蜘蛛侠：平行宇宙2",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2972463076.jpg",
                    avgScore: 8.7,
                    scoreCount: 98765,
                    category: "动画/动作/科幻",
                    region: "美国",
                    year: "21世纪20年代",
                    director: "乔伊姆·多斯·桑托斯,凯普·鲍尔斯,贾斯汀·汤普森",
                    actors: "沙梅克·摩尔,海莉·斯坦菲尔德,奥斯卡·伊萨克",
                    releaseDate: "2023-06-02",
                    duration: 140,
                    intro: "影片讲述了“小黑蛛”迈尔斯·莫拉莱斯，誓言打破三代蜘蛛侠都曾经历的“救一个人还是救全世界”的命运魔咒，穿越多元宇宙与女蜘蛛侠格温携手寻找蜘蛛侠联盟，阻止反派“斑点”摧毁多元宇宙的故事。"
                },
                {
                    id: "movie003",
                    title: "千与千寻",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg",
                    avgScore: 9.4,
                    scoreCount: 234567,
                    category: "动画/奇幻",
                    region: "日本",
                    year: "21世纪00年代",
                    director: "宫崎骏",
                    actors: "柊瑠美,入野自由,夏木真理",
                    releaseDate: "2001-07-20",
                    duration: 125,
                    intro: "10岁的少女千寻与父母一起从都市搬家到了乡下。没想到在搬家的途中，他们进入了一个神秘的隧道，来到了一个由神灵、妖怪和魔法构成的异世界。父母因为贪吃变成了猪，千寻必须在这个陌生的世界中生存下去，拯救父母并找到回家的路。"
                },
                {
                    id: "movie004",
                    title: "肖申克的救赎",
                    poster: "https://img1.doubanio.com/view/photo/s_ratio_poster/public/p480980688.jpg",
                    avgScore: 9.7,
                    scoreCount: 345678,
                    category: "剧情/犯罪",
                    region: "美国",
                    year: "20世纪90年代",
                    director: "弗兰克·德拉邦特",
                    actors: "蒂姆·罗宾斯,摩根·弗里曼,鲍勃·冈顿",
                    releaseDate: "1994-09-10",
                    duration: 142,
                    intro: "银行家安迪因被诬告谋杀妻子及其情人而被判无期徒刑，进入了肖申克监狱。在狱中，他凭借自己的智慧和坚韧，与狱友瑞德建立了深厚的友谊，并最终策划了一场震惊所有人的越狱，重获自由。"
                }
            ],
            users: [
                {
                    id: "user001",
                    username: "admin",
                    password: "admin123",
                    isAdmin: true,
                    avatar: "",
                    intro: "系统管理员",
                    collectedMovies: ["movie001", "movie004"],
                    watchedMovies: ["movie001", "movie002"],
                    toWatchMovies: ["movie003"],
                    myReviews: ["review001"]
                },
                {
                    id: "user002",
                    username: "testuser",
                    password: "test123",
                    isAdmin: false,
                    avatar: "",
                    intro: "普通用户，喜欢看电影",
                    collectedMovies: ["movie002", "movie003"],
                    watchedMovies: ["movie002", "movie003"],
                    toWatchMovies: ["movie001", "movie004"],
                    myReviews: ["review002"]
                }
            ],
            reviews: [
                {
                    id: "review001",
                    userId: "user001",
                    movieId: "movie001",
                    username: "admin",
                    score: 5,
                    content: "流浪地球2绝对是中国科幻电影的里程碑之作！特效震撼，剧情饱满，家国情怀与人类命运的主题结合得非常好，强烈推荐！",
                    likeCount: 128,
                    comments: ["同意！我也觉得超好看", "特效确实比第一部进步很多"]
                },
                {
                    id: "review002",
                    userId: "user002",
                    movieId: "movie002",
                    username: "testuser",
                    score: 4,
                    content: "平行宇宙的设定很有创意，画面风格独特，就是剧情节奏有点慢，整体还是很精彩的，期待下一部！",
                    likeCount: 89,
                    comments: ["节奏慢+1，但画面真的绝了", "我觉得节奏刚好，细节很多"]
                }
            ],
            currentUser: null,
            currentMovie: null,
            authMode: "login" // "login" 或 "register"
        };

        // 页面加载时初始化数据（从localStorage读取或使用默认数据）
        window.onload = function() {
            const savedData = localStorage.getItem("movieReviewSystemData");
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                localStorage.setItem("movieReviewSystemData", JSON.stringify(appData));
            }
            renderMovieList(appData.movies);
            updateUserStatus();
            renderAdminTables();
        };

        // 1. 电影浏览模块功能
        // 渲染电影列表
        function renderMovieList(movies) {
            const movieList = document.getElementById("movie-list");
            movieList.innerHTML = "";
            if (movies.length === 0) {
                movieList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>暂无符合条件的电影</p>";
                return;
            }
            movies.forEach(movie => {
                const movieCard = document.createElement("div");
                movieCard.className = "movie-card";
                movieCard.innerHTML = `
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-score">★ ${movie.avgScore} (${movie.scoreCount}人评分)</div>
                        <div class="movie-tag">${movie.category} | ${movie.region} | ${movie.year}</div>
                        <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">查看详情</button>
                    </div>
                `;
                movieList.appendChild(movieCard);
            });
        }

        // 筛选电影
        function filterMovies() {
            const category = document.getElementById("category-filter").value;
            const region = document.getElementById("region-filter").value;
            const year = document.getElementById("year-filter").value;
            let filteredMovies = appData.movies;
            
            if (category !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.category.includes(category));
            }
            if (region !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.region === region);
            }
            if (year !== "all") {
                filteredMovies = filteredMovies.filter(movie => movie.year === year);
            }
            renderMovieList(filteredMovies);
        }

        // 搜索电影
        function searchMovie() {
            const keyword = document.getElementById("search-input").value.trim().toLowerCase();
            if (!keyword) {
                renderMovieList(appData.movies);
                return;
            }
            const searchedMovies = appData.movies.filter(movie => 
                movie.title.toLowerCase().includes(keyword) ||
                movie.actors.toLowerCase().includes(keyword) ||
                movie.director.toLowerCase().includes(keyword)
            );
            renderMovieList(searchedMovies);
        }

        // 查看电影详情（跳转至评价互动模块）
        function showMovieDetail(movieId) {
            const movie = appData.movies.find(m => m.id === movieId);
            if (!movie) return;
            appData.currentMovie = movie;
            
            // 显示评价互动模块，隐藏其他模块
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("review-module").classList.remove("hidden");
            
            // 渲染电影详情
            const movieDetail = document.getElementById("movie-detail");
            movieDetail.innerHTML = `
                <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                    <img src="${movie.poster}" alt="${movie.title}" style="width: 220px; height: 330px; object-fit: cover; border-radius: 8px;">
                    <div style="flex: 1;">
                        <h2 style="margin-bottom: 15px;">${movie.title}</h2>
                        <p style="margin-bottom: 8px;"><strong>评分：</strong>★ ${movie.avgScore} (${movie.scoreCount}人评分)</p>
                        <p style="margin-bottom: 8px;"><strong>类别：</strong>${movie.category}</p>
                        <p style="margin-bottom: 8px;"><strong>地区：</strong>${movie.region}</p>
                        <p style="margin-bottom: 8px;"><strong>年代：</strong>${movie.year}</p>
                        <p style="margin-bottom: 8px;"><strong>导演：</strong>${movie.director}</p>
                        <p style="margin-bottom: 8px;"><strong>演员：</strong>${movie.actors}</p>
                        <p style="margin-bottom: 8px;"><strong>上映时间：</strong>${movie.releaseDate}</p>
                        <p style="margin-bottom: 8px;"><strong>片长：</strong>${movie.duration}分钟</p>
                        <p style="margin-bottom: 15px;"><strong>简介：</strong>${movie.intro}</p>
                        ${appData.currentUser ? `
                            <div style="display: flex; gap: 15px;">
                                <button class="admin-btn" onclick="collectMovie('${movie.id}')">
                                    ${appData.currentUser.collectedMovies.includes(movie.id) ? '取消收藏' : '收藏电影'}
                                </button>
                                <button class="admin-btn" onclick="addToWatchList('${movie.id}')">
                                    ${appData.currentUser.watchedMovies.includes(movie.id) ? '已观看' : (appData.currentUser.toWatchMovies.includes(movie.id) ? '取消待看' : '添加到待看')}
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // 渲染影评列表
            renderReviewList(movieId);
        }

        // 2. 评价互动模块功能
        // 设置评分
        function setScore(score) {
            const stars = document.querySelectorAll(".score-star");
            stars.forEach((star, index) => {
                if (index < score) {
                    star.classList.add("active");
                } else {
                    star.classList.remove("active");
                }
            });
            document.getElementById("selected-score").value = score;
        }

        // 提交影评
        function submitReview() {
            if (!appData.currentUser) {
                alert("请先登录后再发表评价！");
                showLoginModal();
                return;
            }
            const movieId = appData.currentMovie.id;
            const score = parseInt(document.getElementById("selected-score").value);
            const content = document.getElementById("review-content").value.trim();
            
            if (score === 0 || !content) {
                alert("请选择评分并输入评价内容！");
                return;
            }
            
            // 创建新影评
            const reviewId = "review" + (appData.reviews.length + 1);
            const newReview = {
                id: reviewId,
                userId: appData.currentUser.id,
                username: appData.currentUser.username,
                movieId: movieId,
                score: score,
                content: content,
                likeCount: 0,
                comments: []
            };
            
            // 更新数据
            appData.reviews.push(newReview);
            appData.currentUser.myReviews.push(reviewId);
            
            // 更新电影评分
            const movie = appData.movies.find(m => m.id === movieId);
            const totalScore = movie.avgScore * movie.scoreCount + score;
            movie.scoreCount += 1;
            movie.avgScore = (totalScore / movie.scoreCount).toFixed(1) * 1;
            
            // 保存数据并重新渲染
            saveData();
            renderReviewList(movieId);
            document.getElementById("selected-score").value = 0;
            document.getElementById("review-content").value = "";
            setScore(0);
            alert("评价提交成功！");
        }

        // 渲染影评列表
        function renderReviewList(movieId) {
            const reviewList = document.getElementById("review-list");
            const reviews = appData.reviews.filter(r => r.movieId === movieId);
            reviewList.innerHTML = "";
            
            if (reviews.length === 0) {
                reviewList.innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>暂无影评，快来发表你的看法吧！</p>";
                return;
            }
            
            reviews.forEach(review => {
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item";
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-user">${review.username}</div>
                        <div class="review-score">★ ${review.score}</div>
                    </div>
                    <div class="review-content">${review.content}</div>
                    <div class="review-actions">
                        <div class="review-action" onclick="likeReview('${review.id}')">
                            <span>👍</span> ${review.likeCount}
                        </div>
                        <div class="review-action" onclick="commentReview('${review.id}')">
                            <span>💬</span> 评论 (${review.comments.length})
                        </div>
                        ${appData.currentUser && (appData.currentUser.isAdmin || appData.currentUser.id === review.userId) ? `
                            <div class="review-action" style="color: #e74c3c;" onclick="deleteReview('${review.id}')">
                                删除
                            </div>
                        ` : ''}
                    </div>
                `;
                reviewList.appendChild(reviewItem);
            });
        }

        // 点赞影评
        function likeReview(reviewId) {
            if (!appData.currentUser) {
                alert("请先登录后再点赞！");
                showLoginModal();
                return;
            }
            const review = appData.reviews.find(r => r.id === reviewId);
            review.likeCount += 1;
            saveData();
            renderReviewList(appData.currentMovie.id);
        }

        // 评论影评（简化版，实际可扩展为弹窗输入）
        function commentReview(reviewId) {
            if (!appData.currentUser) {
                alert("请先登录后再评论！");
                showLoginModal();
                return;
            }
            const comment = prompt("请输入你的评论：");
            if (comment && comment.trim()) {
                const review = appData.reviews.find(r => r.id === reviewId);
                review.comments.push(comment.trim());
                saveData();
                renderReviewList(appData.currentMovie.id);
            }
        }

        // 删除影评
        function deleteReview(reviewId) {
            const confirmDelete = confirm("确定要删除这条影评吗？");
            if (!confirmDelete) return;
            
            // 找到影评并更新数据
            const reviewIndex = appData.reviews.findIndex(r => r.id === reviewId);
            const review = appData.reviews[reviewIndex];
            appData.reviews.splice(reviewIndex, 1);
            
            // 从用户的影评列表中移除
            const user = appData.users.find(u => u.id === review.userId);
            const reviewUserIndex = user.myReviews.findIndex(id => id === reviewId);
            if (reviewUserIndex !== -1) {
                user.myReviews.splice(reviewUserIndex, 1);
            }
            
            // 更新电影评分（简化：不回退评分，实际可根据需求调整）
            const movie = appData.movies.find(m => m.id === review.movieId);
            movie.scoreCount -= 1;
            if (movie.scoreCount === 0) {
                movie.avgScore = 0;
            } else {
                const totalScore = movie.avgScore * (movie.scoreCount + 1) - review.score;
                movie.avgScore = (totalScore / movie.scoreCount).toFixed(1) * 1;
            }
            
            // 保存数据并重新渲染
            saveData();
            renderReviewList(review.movieId);
        }

        // 3. 用户中心模块功能
        // 切换用户中心标签
        function showUserTab(tabName) {
            // 隐藏所有标签
            document.querySelectorAll(".user-tab").forEach(tab => tab.classList.add("hidden"));
            document.querySelectorAll(".sidebar-item").forEach(item => item.classList.remove("active"));
            
            // 显示选中标签
            document.getElementById(`${tabName}-tab`).classList.remove("hidden");
            document.querySelector(`.sidebar-item[onclick="showUserTab('${tabName}')"]`).classList.add("active");
            
            // 渲染对应内容
            if (tabName === "my-reviews") {
                renderMyReviews();
            } else if (tabName === "collected") {
                renderCollectedMovies();
            } else if (tabName === "watch-list") {
                renderWatchList();
            }
        }

        // 渲染我的影评
        function renderMyReviews() {
            const myReviewsList = document.getElementById("my-reviews-list");
            const myReviews = appData.reviews.filter(r => appData.currentUser.myReviews.includes(r.id));
            myReviewsList.innerHTML = "";
            
            if (myReviews.length === 0) {
                myReviewsList.innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>你还没有发表过影评</p>";
                return;
            }
            
            myReviews.forEach(review => {
                const movie = appData.movies.find(m => m.id === review.movieId);
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item";
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-user">${movie.title}</div>
                        <div class="review-score">★ ${review.score}</div>
                    </div>
                    <div class="review-content">${review.content}</div>
                    <div class="review-actions">
                        <div class="review-action">
                            <span>👍</span> ${review.likeCount}
                        </div>
                        <div class="review-action">
                            <span>💬</span> ${review.comments.length}
                        </div>
                        <div class="review-action" style="color: #e74c3c;" onclick="deleteReview('${review.id}')">
                            删除
                        </div>
                    </div>
                `;
                myReviewsList.appendChild(reviewItem);
            });
        }

        // 渲染收藏电影
        function renderCollectedMovies() {
            const collectedList = document.getElementById("collected-list");
            const collectedMovies = appData.movies.filter(m => appData.currentUser.collectedMovies.includes(m.id));
            collectedList.innerHTML = "";
            
            if (collectedMovies.length === 0) {
                collectedList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>你还没有收藏任何电影</p>";
                return;
            }
            
            collectedMovies.forEach(movie => {
                const movieCard = document.createElement("div");
                movieCard.className = "movie-card";
                movieCard.innerHTML = `
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-score">★ ${movie.avgScore}</div>
                        <div class="movie-tag">${movie.category}</div>
                        <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">查看详情</button>
                        <button class="movie-btn" style="margin-top: 8px; background-color: #e74c3c;" onclick="collectMovie('${movie.id}')">取消收藏</button>
                    </div>
                `;
                collectedList.appendChild(movieCard);
            });
        }

        // 渲染观影清单
        function renderWatchList() {
            // 已看电影
            const watchedList = document.getElementById("watched-list");
            const watchedMovies = appData.movies.filter(m => appData.currentUser.watchedMovies.includes(m.id));
            watchedList.innerHTML = "";
            
            if (watchedMovies.length === 0) {
                watchedList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>你还没有标记任何已看电影</p>";
            } else {
                watchedMovies.forEach(movie => {
                    const movieCard = document.createElement("div");
                    movieCard.className = "movie-card";
                    movieCard.innerHTML = `
                        <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-score">★ ${movie.avgScore}</div>
                            <div class="movie-tag">${movie.category}</div>
                            <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">查看详情</button>
                            <button class="movie-btn" style="margin-top: 8px; background-color: #95a5a6;" onclick="addToWatchList('${movie.id}')">取消已看</button>
                        </div>
                    `;
                    watchedList.appendChild(movieCard);
                });
            }
            
            // 待看电影
            const toWatchList = document.getElementById("to-watch-list");
            const toWatchMovies = appData.movies.filter(m => appData.currentUser.toWatchMovies.includes(m.id));
            toWatchList.innerHTML = "";
            
            if (toWatchMovies.length === 0) {
                toWatchList.innerHTML = "<p style='grid-column: 1/-1; text-align: center; padding: 20px; color: #7f8c8d;'>你还没有添加任何待看电影</p>";
            } else {
                toWatchMovies.forEach(movie => {
                    const movieCard = document.createElement("div");
                    movieCard.className = "movie-card";
                    movieCard.innerHTML = `
                        <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-score">★ ${movie.avgScore}</div>
                            <div class="movie-tag">${movie.category}</div>
                            <button class="movie-btn" onclick="showMovieDetail('${movie.id}')">查看详情</button>
                            <button class="movie-btn" style="margin-top: 8px; background-color: #2ecc71;" onclick="markAsWatched('${movie.id}')">标记为已看</button>
                        </div>
                    `;
                    toWatchList.appendChild(movieCard);
                });
            }
        }

        // 收藏/取消收藏电影
        function collectMovie(movieId) {
            const user = appData.currentUser;
            const index = user.collectedMovies.findIndex(id => id === movieId);
            
            if (index === -1) {
                user.collectedMovies.push(movieId);
                alert("电影收藏成功！");
            } else {
                user.collectedMovies.splice(index, 1);
                alert("电影取消收藏成功！");
            }
            
            saveData();
            if (document.getElementById("collected-tab").classList.contains("active")) {
                renderCollectedMovies();
            }
            if (appData.currentMovie) {
                showMovieDetail(movieId);
            }
        }

        // 添加/取消待看电影
        function addToWatchList(movieId) {
            const user = appData.currentUser;
            const watchedIndex = user.watchedMovies.findIndex(id => id === movieId);
            const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
            
            if (watchedIndex !== -1) {
                alert("该电影已标记为已看，无法添加到待看清单！");
                return;
            }
            
            if (toWatchIndex === -1) {
                user.toWatchMovies.push(movieId);
                alert("电影添加到待看清单成功！");
            } else {
                user.toWatchMovies.splice(toWatchIndex, 1);
                alert("电影从待看清单移除成功！");
            }
            
            saveData();
            if (document.getElementById("watch-list-tab").classList.contains("active")) {
                renderWatchList();
            }
            if (appData.currentMovie) {
                showMovieDetail(movieId);
            }
        }

        // 标记电影为已看
        function markAsWatched(movieId) {
            const user = appData.currentUser;
            const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
            
            if (toWatchIndex !== -1) {
                user.toWatchMovies.splice(toWatchIndex, 1);
                user.watchedMovies.push(movieId);
                alert("电影标记为已看成功！");
                saveData();
                renderWatchList();
            }
        }

        // 保存个人资料
        function saveProfile() {
            const intro = document.getElementById("user-intro").value.trim();
            appData.currentUser.intro = intro;
            saveData();
            alert("个人资料保存成功！");
        }

        // 4. 管理员模块功能
        // 渲染管理员表格
        function renderAdminTables() {
            // 电影表格
            const movieTable = document.getElementById("admin-movie-table");
            movieTable.innerHTML = "";
            appData.movies.forEach(movie => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${movie.id}</td>
                    <td>${movie.title}</td>
                    <td>${movie.category}</td>
                    <td>${movie.region}</td>
                    <td>
                        <button class="admin-btn edit-btn" onclick="editMovie('${movie.id}')">编辑</button>
                        <button class="admin-btn delete-btn" onclick="deleteMovie('${movie.id}')">删除</button>
                    </td>
                `;
                movieTable.appendChild(row);
            });
            
            // 影评表格
            const reviewTable = document.getElementById("admin-review-table");
            reviewTable.innerHTML = "";
            appData.reviews.forEach(review => {
                const movie = appData.movies.find(m => m.id === review.movieId);
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${review.id}</td>
                    <td>${review.username}</td>
                    <td>${movie ? movie.title : '未知电影'}</td>
                    <td style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${review.content}</td>
                    <td>
                        <button class="admin-btn delete-btn" onclick="deleteReview('${review.id}')">删除</button>
                    </td>
                `;
                reviewTable.appendChild(row);
            });
            
            // 用户表格
            const userTable = document.getElementById("admin-user-table");
            userTable.innerHTML = "";
            appData.users.forEach(user => {
                if (user.username === "admin") return; // 不允许操作管理员账号
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>
                        <button class="admin-btn delete-btn" onclick="deleteUser('${user.id}')">封禁账号</button>
                    </td>
                `;
                userTable.appendChild(row);
            });
        }

        // 添加电影
        function addMovie() {
            const title = document.getElementById("movie-title").value.trim();
            const category = document.getElementById("movie-category").value.trim();
            const region = document.getElementById("movie-region").value.trim();
            const year = document.getElementById("movie-year").value.trim();
            const director = document.getElementById("movie-director").value.trim();
            const actors = document.getElementById("movie-actors").value.trim();
            const releaseDate = document.getElementById("movie-release").value.trim();
            const duration = parseInt(document.getElementById("movie-duration").value);
            const intro = document.getElementById("movie-intro").value.trim();
            
            if (!title || !category || !region || !year || !director || !actors || !releaseDate || !duration || !intro) {
                alert("请填写所有电影信息！");
                return;
            }
            
            // 创建新电影
            const movieId = "movie" + (appData.movies.length + 1);
            const newMovie = {
                id: movieId,
                title: title,
                poster: "https://via.placeholder.com/200x300?text=暂无海报",
                avgScore: 0,
                scoreCount: 0,
                category: category,
                region: region,
                year: year,
                director: director,
                actors: actors,
                releaseDate: releaseDate,
                duration: duration,
                intro: intro
            };
            
            appData.movies.push(newMovie);
            saveData();
            renderAdminTables();
            renderMovieList(appData.movies);
            closeModal();
            document.getElementById("add-movie-form").reset();
            alert("电影添加成功！");
        }

        // 编辑电影（简化版，实际可扩展为弹窗修改）
        function editMovie(movieId) {
            const movie = appData.movies.find(m => m.id === movieId);
            const newTitle = prompt("请输入新的电影标题（当前：" + movie.title + "）：");
            if (newTitle && newTitle.trim()) {
                movie.title = newTitle.trim();
                saveData();
                renderAdminTables();
                renderMovieList(appData.movies);
                alert("电影标题修改成功！");
            }
        }

        // 删除电影
        function deleteMovie(movieId) {
            const confirmDelete = confirm("确定要删除该电影吗？删除后相关影评也会被删除！");
            if (!confirmDelete) return;
            
            // 删除电影
            const movieIndex = appData.movies.findIndex(m => m.id === movieId);
            appData.movies.splice(movieIndex, 1);
            
            // 删除相关影评
            const reviewsToDelete = appData.reviews.filter(r => r.movieId === movieId);
            reviewsToDelete.forEach(review => {
                const reviewIndex = appData.reviews.findIndex(r => r.id === review.id);
                appData.reviews.splice(reviewIndex, 1);
                
                // 从用户影评列表中移除
                const user = appData.users.find(u => u.id === review.userId);
                const userReviewIndex = user.myReviews.findIndex(id => id === review.id);
                if (userReviewIndex !== -1) {
                    user.myReviews.splice(userReviewIndex, 1);
                }
            });
            
            // 从用户收藏和观影清单中移除
            appData.users.forEach(user => {
                const collectedIndex = user.collectedMovies.findIndex(id => id === movieId);
                if (collectedIndex !== -1) user.collectedMovies.splice(collectedIndex, 1);
                
                const watchedIndex = user.watchedMovies.findIndex(id => id === movieId);
                if (watchedIndex !== -1) user.watchedMovies.splice(watchedIndex, 1);
                
                const toWatchIndex = user.toWatchMovies.findIndex(id => id === movieId);
                if (toWatchIndex !== -1) user.toWatchMovies.splice(toWatchIndex, 1);
            });
            
            saveData();
            renderAdminTables();
            renderMovieList(appData.movies);
            alert("电影删除成功！");
        }

        // 删除用户（封禁账号）
        function deleteUser(userId) {
            const confirmDelete = confirm("确定要封禁该用户账号吗？用户的影评和收藏会被保留！");
            if (!confirmDelete) return;
            
            // 从用户列表中移除（简化：实际可改为标记为封禁状态）
            const userIndex = appData.users.findIndex(u => u.id === userId);
            appData.users.splice(userIndex, 1);
            
            // 如果当前登录用户是被封禁的用户，强制退出
            if (appData.currentUser && appData.currentUser.id === userId) {
                logout();
            }
            
            saveData();
            renderAdminTables();
            alert("用户账号封禁成功！");
        }

        // 5. 登录/注册功能
        // 显示登录模态框
        function showLoginModal() {
            appData.authMode = "login";
            document.getElementById("modal-title").textContent = "用户登录";
            document.querySelector("#auth-form button").textContent = "登录";
            document.getElementById("login-modal").style.display = "flex";
        }

        // 切换登录/注册模式
        function toggleAuthMode() {
            appData.authMode = appData.authMode === "login" ? "register" : "login";
            const title = appData.authMode === "login" ? "用户登录" : "用户注册";
            const btnText = appData.authMode === "login" ? "登录" : "注册";
            const toggleText = appData.authMode === "login" ? "还没有账号？点击注册" : "已有账号？点击登录";
            
            document.getElementById("modal-title").textContent = title;
            document.querySelector("#auth-form button").textContent = btnText;
            document.querySelector("#auth-form p").textContent = toggleText;
        }

        // 提交登录/注册
        function submitAuth() {
            const username = document.getElementById("auth-username").value.trim();
            const password = document.getElementById("auth-password").value.trim();
            
            if (appData.authMode === "login") {
                // 登录
                const user = appData.users.find(u => u.username === username && u.password === password);
                if (user) {
                    appData.currentUser = user;
                    saveData();
                    updateUserStatus();
                    closeModal();
                    alert("登录成功！");
                } else {
                    alert("用户名或密码错误！");
                }
            } else {
                // 注册
                const userExists = appData.users.some(u => u.username === username);
                if (userExists) {
                    alert("用户名已存在，请更换用户名！");
                    return;
                }
                if (password.length < 6) {
                    alert("密码长度不能少于6位！");
                    return;
                }
                
                // 创建新用户
                const userId = "user" + (appData.users.length + 1);
                const newUser = {
                    id: userId,
                    username: username,
                    password: password,
                    isAdmin: false,
                    avatar: "",
                    intro: "",
                    collectedMovies: [],
                    watchedMovies: [],
                    toWatchMovies: [],
                    myReviews: []
                };
                
                appData.users.push(newUser);
                appData.currentUser = newUser;
                saveData();
                updateUserStatus();
                closeModal();
                document.getElementById("auth-form").reset();
                alert("注册成功！");
            }
        }

        // 退出登录
        function logout() {
            appData.currentUser = null;
            saveData();
            updateUserStatus();
            // 回到电影浏览模块
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("movie-module").classList.remove("hidden");
        }

        // 更新用户登录状态
        function updateUserStatus() {
            const loginText = document.getElementById("login-text");
            const loginBtn = document.getElementById("login-btn");
            const userAvatar = document.getElementById("user-avatar");
            const logoutBtn = document.getElementById("logout-btn");
            const navReview = document.getElementById("nav-review");
            const navUser = document.getElementById("nav-user");
            const navAdmin = document.getElementById("nav-admin");
            
            if (appData.currentUser) {
                // 已登录
                loginText.textContent = appData.currentUser.username;
                loginText.style.display = "inline-block";
                loginBtn.style.display = "none";
                userAvatar.classList.remove("hidden");
                logoutBtn.classList.remove("hidden");
                navReview.classList.remove("hidden");
                navUser.classList.remove("hidden");
                
                // 管理员显示后台入口
                if (appData.currentUser.isAdmin) {
                    navAdmin.classList.remove("hidden");
                } else {
                    navAdmin.classList.add("hidden");
                }
                
                // 更新头像初始字母
                document.getElementById("avatar-initial").textContent = appData.currentUser.username[0].toUpperCase();
                document.getElementById("profile-initial").textContent = appData.currentUser.username[0].toUpperCase();
                document.getElementById("username").value = appData.currentUser.username;
                document.getElementById("user-intro").value = appData.currentUser.intro;
            } else {
                // 未登录
                loginText.textContent = "未登录";
                loginBtn.style.display = "inline-block";
                userAvatar.classList.add("hidden");
                logoutBtn.classList.add("hidden");
                navReview.classList.add("hidden");
                navUser.classList.add("hidden");
                navAdmin.classList.add("hidden");
            }
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById("login-modal").style.display = "none";
            document.getElementById("add-movie-modal").style.display = "none";
            document.getElementById("auth-form").reset();
        }

        // 显示添加电影模态框
        function showAddMovieModal() {
            document.getElementById("add-movie-modal").style.display = "flex";
        }

        // 保存数据到localStorage
        function saveData() {
            localStorage.setItem("movieReviewSystemData", JSON.stringify(appData));
        }

        // 导航栏切换模块
        document.getElementById("nav-movie").onclick = function() {
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("movie-module").classList.remove("hidden");
        };

        document.getElementById("nav-review").onclick = function() {
            if (!appData.currentUser) {
                alert("请先登录后再进入评价互动模块！");
                showLoginModal();
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("review-module").classList.remove("hidden");
            if (appData.currentMovie) {
                showMovieDetail(appData.currentMovie.id);
            } else {
                document.getElementById("movie-detail").innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>请先从电影浏览模块选择一部电影查看详情</p>";
                document.getElementById("review-list").innerHTML = "<p style='text-align: center; padding: 20px; color: #7f8c8d;'>暂无影评</p>";
            }
        };

        document.getElementById("nav-user").onclick = function() {
            if (!appData.currentUser) {
                alert("请先登录后再进入用户中心！");
                showLoginModal();
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("admin-module").classList.add("hidden");
            document.getElementById("user-module").classList.remove("hidden");
            showUserTab("profile"); // 默认显示个人资料
        };

        document.getElementById("nav-admin").onclick = function() {
            if (!appData.currentUser || !appData.currentUser.isAdmin) {
                alert("无管理员权限，无法进入管理员后台！");
                return;
            }
            document.getElementById("movie-module").classList.add("hidden");
            document.getElementById("review-module").classList.add("hidden");
            document.getElementById("user-module").classList.add("hidden");
            document.getElementById("admin-module").classList.remove("hidden");
            renderAdminTables();
        };

        // 点击模态框外部关闭模态框
        window.onclick = function(event) {
            const loginModal = document.getElementById("login-modal");
            const addMovieModal = document.getElementById("add-movie-modal");
            if (event.target === loginModal) {
                closeModal();
            }
            if (event.target === addMovieModal) {
                closeModal();
            }
        };

        // 绑定筛选下拉框变化事件
        document.getElementById("category-filter").onchange = filterMovies;
        document.getElementById("region-filter").onchange = filterMovies;
        document.getElementById("year-filter").onchange = filterMovies;
    </script>
</body>
</html>
